import React, { Component } from 'react';
import SvgIcon from 'des-svg-icons';
import { DateTime } from 'luxon';
import Avatar from '../features/Avatar';
import { Link } from 'react-router-dom';
import HttpRequest, { ProcessHttpMessage } from 'des-http-processor';
import { MyConfig } from '../../MyConfig';
import PostCard, { UserPostCard } from './PostCard';
import InfiniteScroll from 'react-infinite-scroller';
const dayjs = require('dayjs')
const calendarjs = require('dayjs/plugin/calendar')
dayjs.extend(calendarjs)


export default class UserProfile extends Component {
  constructor(props) {
    super(props);

    // fetch user's posts
    this.state = { posts: null };
    HttpRequest(
      MyConfig.apiUrl +
      `get-posts-by-user?email=${props.user.email}&per_page=3`,
      'get',
      null,
      ProcessHttpMessage
    ).then((response) => {
      this.setState({ posts: response.data });
      // console.log(response);
    });
  }
  render() {
    const user = this.props.user;
    return (
      <>
        <div class="inline-flex flex-col space-y-3.5 items-start justify-start w-full">
          <div class="p-3 sm:p-8 white-gray-bg shadow w-full">
            <div class="inline-flex flex-col space-y-9 items-start justify-center w-full">
              <div class="inline-flex space-x-3 sm:space-x-9 items-center justify-center flex-wrap 3xs:flex-nowrap">
                <Avatar
                  pic={user.image}
                  imgSize="h-24 w-24 lg:h-48 lg:w-48"
                  imgRounded="rounded-none"
                />
                <div class="inline-flex flex-col space-y-3.5 items-start justify-start">
                  <p class="text-sm sm:text-3xl font-bold xs:leading-9 text-gray-900">
                    {user.name}
                  </p>
                  <p class="text-xs sm:text-base leading-tight text-black text-opacity-50">
                    {user.bio}
                    <br />
                  </p>
                </div>
              </div>
              <div class="flex space-x-5 items-start justify-between lg:justify-center">
                <div class="flex space-x-1 lg:space-x-3 items-start justify-start">
                  <svg width={25} height={25} fill="none">
                    <g clipPath="url(#prefix__clip0_2783_4145)">
                      <path
                        d="M15.772 1.593h-6v2h6v-2zm-4 13h2v-6h-2v6zm8.025-6.615l1.425-1.425c-.43-.515-.9-.985-1.415-1.415l-1.425 1.425a8.956 8.956 0 00-5.615-1.97c-4.975 0-8.995 4.03-8.995 9s4.02 9 8.995 9 9.005-4.03 9.005-9c0-2.125-.74-4.075-1.975-5.615zm-7.025 12.615c-3.865 0-7-3.135-7-7s3.135-7 7-7 7 3.135 7 7-3.135 7-7 7z"
                        fill="#5D5FEF"
                      />
                    </g>
                    <defs>
                      <clipPath id="prefix__clip0_2783_4145">
                        <path
                          fill="#fff"
                          transform="translate(.772 .593)"
                          d="M0 0h24v24H0z"
                        />
                      </clipPath>
                    </defs>
                  </svg>
                  <div class="inline-flex flex-col space-y-1 items-start justify-start">
                    <p class="w-full h-1/2 text-xs lg:text-sm font-semibold lg:leading-loose text-gray-900">
                      {dayjs(user.last_login).calendar(null, { sameElse: 'ddd, DD MMM, h:mm a' })}
                    </p>
                    <p class="text-2xs lg:text-xs leading-tight text-black text-opacity-40">
                      Last active
                    </p>
                  </div>
                </div>
                <a
                  class="inline-flex space-x-1 lg:space-x-3 items-center justify-start "
                  href="/editprofile"
                >
                  {this.props.accountOwner && (
                    <>
                      <svg
                        width="20"
                        height="21"
                        viewBox="0 0 20 21"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M17.4143 3.08579C16.6333 2.30474 15.3669 2.30474 14.5859 3.08579L7.00003 10.6716V13.5H9.82847L17.4143 5.91421C18.1954 5.13316 18.1954 3.86683 17.4143 3.08579Z"
                          fill="#5D5FEF"
                        ></path>
                        <path
                          fill-rule="evenodd"
                          clip-rule="evenodd"
                          d="M2 6.5C2 5.39543 2.89544 4.5 4.00001 4.5H8.00004C8.55232 4.5 9.00004 4.94772 9.00004 5.5C9.00004 6.05228 8.55232 6.5 8.00004 6.5H4.00001V16.5H14.0001V12.5C14.0001 11.9477 14.4478 11.5 15.0001 11.5C15.5524 11.5 16.0001 11.9477 16.0001 12.5V16.5C16.0001 17.6046 15.1046 18.5 14.0001 18.5H4.00001C2.89544 18.5 2 17.6046 2 16.5V6.5Z"
                          fill="#5D5FEF"
                        ></path>
                      </svg>
                      <Link to="/editprofile">
                        <p class="w-20 h-full text-xs lg:text-sm font-semibold leading-loose text-gray-900">
                          Edit Profile
                        </p>
                      </Link>
                    </>
                  )}
                </a>
              </div>
              {this.props.accountOwner && (
                <div class="inline-flex items-center justify-end w-full">
                  <Link to="/becomearhendor">
                    <button
                      class="text-sm sm:text-base font-semibold leading-normal text-center text-purple-100 sm:w-52 p-2 px-8 sm:p-4 bg-[#320059] rounded-lg"
                      control-id="ControlID-81"
                    >
                      Become a Rhendor
                    </button>
                  </Link>
                </div>
              )}
            </div>
          </div>
          <div class="p-3 sm:p-8 white-gray-bg shadow w-full">
            <div class="">
              <h2 class="font-bold leading-9 gray-text m-0">Contact</h2>
            </div>
            <hr class="border-gray-300 border-opacity-50 my-5" />
            <div class="inline-flex flex-col space-y-3.5 items-start justify-start ">
              <div class="inline-flex space-x-3.5 items-center justify-center">
                <svg
                  width="22"
                  height="22"
                  viewBox="0 0 22 22"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M11.2293 2.40041C13.1939 2.40912 15.0716 3.19148 16.4451 4.56497C17.8273 5.94715 18.6009 7.81614 18.5923 9.75467V9.79814C18.5401 12.4321 17.0623 14.8574 15.2194 16.7525C14.1762 17.8217 13.0201 18.7693 11.7596 19.569C11.4206 19.8559 10.9251 19.8559 10.586 19.569C8.71704 18.352 7.06538 16.822 5.72666 15.04C4.55311 13.4926 3.88375 11.6324 3.81421 9.69382C3.83159 5.65159 7.15231 2.39173 11.2293 2.40041ZM11.2293 7.55535C9.93405 7.55535 8.8909 8.58981 8.8909 9.87637C8.8909 11.1464 9.91667 12.1713 11.2032 12.1887H11.2293C11.8465 12.1887 12.4376 11.954 12.8723 11.528C13.3243 11.0847 13.5773 10.4944 13.5773 9.87637C13.5773 8.58981 12.5246 7.55535 11.2293 7.55535Z"
                    fill="#200E32"
                  ></path>
                </svg>
                <p class="text-base leading-loose">{user.location}</p>
              </div>
              <div class="inline-flex space-x-3.5 items-center justify-center">
                <svg
                  width="22"
                  height="22"
                  viewBox="0 0 22 22"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clip-path="url(#clip0_2783_4161)">
                    <path
                      d="M11.2057 0.571289H11.2004C5.44875 0.571289 0.771498 5.24984 0.771498 11.0028C0.767926 13.2 1.46343 15.3413 2.75741 17.117L1.45737 20.9924L5.467 19.7106C7.16783 20.839 9.16456 21.4388 11.2057 21.4344C16.9574 21.4344 21.6346 16.7545 21.6346 11.0028C21.6346 5.25115 16.9574 0.571289 11.2057 0.571289Z"
                      fill="#212020"
                    ></path>
                    <path
                      d="M17.2755 15.3023C17.0239 16.013 16.0251 16.6023 15.2283 16.7745C14.6833 16.8905 13.9713 16.9831 11.5747 15.9895C8.50912 14.7194 6.53495 11.6043 6.38108 11.4022C6.23374 11.2001 5.14233 9.75271 5.14233 8.25579C5.14233 6.75886 5.90253 6.02995 6.20896 5.71701C6.46062 5.46013 6.87658 5.34277 7.27559 5.34277C7.40468 5.34277 7.52073 5.34929 7.62504 5.35451C7.93147 5.36755 8.08534 5.3858 8.28745 5.86957C8.53911 6.4759 9.15196 7.97283 9.22498 8.1267C9.29931 8.28056 9.37363 8.48919 9.26932 8.6913C9.17152 8.89993 9.08546 8.99251 8.9316 9.16985C8.77773 9.34719 8.63169 9.4828 8.47782 9.67317C8.337 9.83877 8.17792 10.0161 8.35525 10.3225C8.53259 10.6224 9.14544 11.6226 10.0478 12.4258C11.2122 13.4624 12.1562 13.7936 12.494 13.9345C12.7456 14.0388 13.0455 14.014 13.2294 13.8184C13.4628 13.5668 13.751 13.1495 14.0444 12.7387C14.253 12.4441 14.5164 12.4075 14.7928 12.5119C15.0745 12.6097 16.5649 13.3464 16.8713 13.4989C17.1777 13.6528 17.3799 13.7258 17.4542 13.8549C17.5272 13.984 17.5272 14.5903 17.2755 15.3023Z"
                      fill="#FAFAFA"
                    ></path>
                  </g>
                  <defs>
                    <clipPath id="clip0_2783_4161">
                      <rect
                        width="20.8631"
                        height="20.8631"
                        fill="white"
                        transform="translate(0.771729 0.571289)"
                      ></rect>
                    </clipPath>
                  </defs>
                </svg>
                <p class="text-base leading-loose">{user.whatsapp}</p>
              </div>
              <div class="inline-flex space-x-3.5 items-center justify-center">
                <svg
                  width="22"
                  height="22"
                  viewBox="0 0 22 22"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clip-path="url(#clip0_2783_4166)">
                    <path
                      d="M11.203 21.3426C16.9642 21.3426 21.6346 16.6722 21.6346 10.9111C21.6346 5.14986 16.9642 0.479492 11.203 0.479492C5.44185 0.479492 0.771484 5.14986 0.771484 10.9111C0.771484 16.6722 5.44185 21.3426 11.203 21.3426Z"
                      fill="#2A2438"
                    ></path>
                    <path
                      d="M17.8915 6.76176C17.3995 6.9801 16.871 7.1277 16.3153 7.19404C16.8824 6.85446 17.3169 6.31634 17.522 5.67589C16.9833 5.99584 16.3937 6.22109 15.779 6.34185C15.2786 5.80855 14.5652 5.47559 13.7758 5.47559C12.2608 5.47559 11.032 6.70381 11.032 8.21977C11.032 8.43456 11.0562 8.64411 11.1027 8.84531C8.82201 8.73068 6.79999 7.63819 5.44655 5.97814C5.21022 6.38357 5.07494 6.85496 5.07494 7.3579C5.07494 8.30984 5.55947 9.14975 6.2957 9.64175C5.85986 9.62825 5.43359 9.5106 5.05252 9.29866V9.33334C5.05252 10.663 5.9983 11.7718 7.25377 12.024C7.02315 12.0872 6.78111 12.1202 6.53072 12.1202C6.35369 12.1202 6.18193 12.1034 6.01414 12.0719C6.36336 13.1617 7.37683 13.9551 8.57732 13.9775C7.63813 14.7137 6.45471 15.1526 5.16938 15.1526C4.948 15.1526 4.7292 15.1394 4.5144 15.1135C5.72903 15.8923 7.17121 16.347 8.72099 16.347C13.7684 16.347 16.5288 12.1654 16.5288 8.53916C16.5288 8.42011 16.5262 8.30195 16.5205 8.18421C17.0583 7.7952 17.5225 7.31353 17.8915 6.76176Z"
                      fill="white"
                    ></path>
                  </g>
                  <defs>
                    <clipPath id="clip0_2783_4166">
                      <rect
                        width="20.8631"
                        height="20.8631"
                        fill="white"
                        transform="translate(0.771729 0.479492)"
                      ></rect>
                    </clipPath>
                  </defs>
                </svg>
                <p class="text-base leading-loose">{user.twitter}</p>
              </div>
              <div class="inline-flex space-x-3.5 items-center justify-center">
                <svg
                  width="22"
                  height="22"
                  viewBox="0 0 22 22"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M11.2032 8.66406C10.7768 8.66406 10.36 8.7905 10.0055 9.02739C9.65096 9.26428 9.37464 9.60097 9.21147 9.99491C9.04829 10.3888 9.0056 10.8223 9.08879 11.2405C9.17197 11.6587 9.37729 12.0428 9.6788 12.3443C9.9803 12.6458 10.3644 12.8512 10.7826 12.9343C11.2008 13.0175 11.6343 12.9748 12.0282 12.8117C12.4222 12.6485 12.7589 12.3722 12.9957 12.0176C13.2326 11.6631 13.3591 11.2463 13.3591 10.8199C13.3591 10.5368 13.3033 10.2565 13.195 9.99491C13.0866 9.73335 12.9278 9.49569 12.7276 9.2955C12.5274 9.09531 12.2898 8.93651 12.0282 8.82817C11.7667 8.71982 11.4863 8.66406 11.2032 8.66406ZM19.8353 6.53429C19.8308 5.86298 19.7071 5.1978 19.4702 4.56968C19.2957 4.11004 19.0258 3.69264 18.6781 3.345C18.3305 2.99736 17.9131 2.72739 17.4535 2.55291C16.8253 2.31599 16.1602 2.19238 15.4888 2.1878C14.3675 2.12695 14.0371 2.12695 11.2032 2.12695C8.36931 2.12695 8.03898 2.12695 6.91759 2.1878C6.24628 2.19238 5.5811 2.31599 4.95298 2.55291C4.49334 2.72739 4.07594 2.99736 3.7283 3.345C3.38066 3.69264 3.11069 4.11004 2.93621 4.56968C2.69929 5.1978 2.57568 5.86298 2.5711 6.53429C2.51025 7.65568 2.51025 7.98601 2.51025 10.8199C2.51025 13.6538 2.51025 13.9842 2.5711 15.1055C2.58046 15.7792 2.70391 16.4464 2.93621 17.0788C3.10992 17.5364 3.37966 17.9514 3.72727 18.2959C4.07342 18.6456 4.49172 18.9156 4.95298 19.0869C5.5811 19.3238 6.24628 19.4475 6.91759 19.452C8.03898 19.5129 8.36931 19.5129 11.2032 19.5129C14.0371 19.5129 14.3675 19.5129 15.4888 19.452C16.1602 19.4475 16.8253 19.3238 17.4535 19.0869C17.9147 18.9156 18.333 18.6456 18.6792 18.2959C19.0268 17.9514 19.2965 17.5364 19.4702 17.0788C19.7069 16.4476 19.8305 15.7797 19.8353 15.1055C19.8962 13.9842 19.8962 13.6538 19.8962 10.8199C19.8962 7.98601 19.8962 7.65568 19.8353 6.53429ZM17.6273 13.4887C17.5994 14.0251 17.4849 14.5535 17.2883 15.0534C17.1195 15.4704 16.8686 15.8492 16.5506 16.1673C16.2325 16.4853 15.8537 16.7362 15.4367 16.905C14.9321 17.0907 14.4007 17.1934 13.8633 17.2092C13.1765 17.2092 12.994 17.2092 11.2032 17.2092C9.41247 17.2092 9.22991 17.2092 8.54317 17.2092C8.00571 17.1934 7.47436 17.0907 6.96974 16.905C6.53866 16.7448 6.14937 16.4892 5.83097 16.1574C5.51599 15.8455 5.27274 15.4688 5.11814 15.0534C4.93173 14.5493 4.8318 14.0173 4.82258 13.48C4.82258 12.7932 4.82258 12.6107 4.82258 10.8199C4.82258 9.02916 4.82258 8.84661 4.82258 8.15987C4.8318 7.62249 4.93173 7.09053 5.11814 6.58644C5.27834 6.15536 5.5339 5.76607 5.86574 5.44766C6.17897 5.13439 6.55532 4.8914 6.96974 4.73484C7.47436 4.54917 8.00571 4.44642 8.54317 4.43059C9.22991 4.43059 9.41247 4.43059 11.2032 4.43059C12.994 4.43059 13.1765 4.43059 13.8633 4.43059C14.4007 4.44642 14.9321 4.54917 15.4367 4.73484C15.8678 4.89504 16.2571 5.1506 16.5755 5.48244C16.8904 5.7943 17.1337 6.17103 17.2883 6.58644C17.474 7.09106 17.5767 7.62241 17.5925 8.15987C17.5925 8.84661 17.5925 9.02916 17.5925 10.8199C17.5925 12.6107 17.6534 12.7932 17.6273 13.48V13.4887ZM16.2364 7.02109C16.1329 6.74029 15.9698 6.48529 15.7581 6.27368C15.5465 6.06207 15.2915 5.89888 15.0107 5.79538C14.6252 5.66174 14.2191 5.597 13.8111 5.60414C13.1331 5.60414 12.9418 5.60414 11.2032 5.60414C9.46462 5.60414 9.27338 5.60414 8.59533 5.60414C8.18525 5.60815 7.77912 5.68466 7.3957 5.83016C7.1192 5.92896 6.8669 6.08548 6.65557 6.28932C6.44423 6.49316 6.27871 6.73965 6.16999 7.0124C6.04375 7.39955 5.98207 7.80484 5.98744 8.21203C5.98744 8.89008 5.98744 9.08132 5.98744 10.8199C5.98744 12.5585 5.98744 12.7498 5.98744 13.4278C5.99606 13.8374 6.07243 14.2428 6.21346 14.6274C6.31696 14.9082 6.48014 15.1632 6.69175 15.3748C6.90337 15.5865 7.15837 15.7496 7.43916 15.8531C7.81006 15.9895 8.20037 16.0658 8.59533 16.0792C9.27338 16.0792 9.46462 16.0792 11.2032 16.0792C12.9418 16.0792 13.1331 16.0792 13.8111 16.0792C14.2212 16.0751 14.6273 15.9986 15.0107 15.8531C15.2915 15.7496 15.5465 15.5865 15.7581 15.3748C15.9698 15.1632 16.1329 14.9082 16.2364 14.6274C16.3819 14.244 16.4584 13.8379 16.4625 13.4278C16.4625 12.7498 16.4625 12.5585 16.4625 10.8199C16.4625 9.08132 16.4625 8.89008 16.4625 8.21203C16.4627 7.80154 16.386 7.39465 16.2364 7.0124V7.02109ZM11.2032 14.1406C10.7675 14.1406 10.3362 14.0547 9.93375 13.8877C9.53135 13.7207 9.16585 13.476 8.85819 13.1675C8.55052 12.859 8.30674 12.4929 8.14081 12.09C7.97488 11.6872 7.89005 11.2556 7.8912 10.8199C7.8912 10.1628 8.08618 9.5204 8.45145 8.97413C8.81672 8.42785 9.33586 8.00223 9.94314 7.75115C10.5504 7.50008 11.2186 7.43482 11.863 7.56366C12.5073 7.6925 13.099 8.00963 13.5631 8.47491C14.0271 8.94019 14.3427 9.53269 14.4699 10.1774C14.597 10.8221 14.53 11.4901 14.2773 12.0967C14.0247 12.7034 13.5977 13.2214 13.0505 13.5852C12.5032 13.9491 11.8604 14.1423 11.2032 14.1406ZM14.6804 8.15118C14.4882 8.13084 14.3104 8.0401 14.1811 7.89645C14.0519 7.75279 13.9804 7.56639 13.9804 7.37316C13.9804 7.17992 14.0519 6.99352 14.1811 6.84986C14.3104 6.70621 14.4882 6.61548 14.6804 6.59514C14.8726 6.61548 15.0504 6.70621 15.1797 6.84986C15.3089 6.99352 15.3804 7.17992 15.3804 7.37316C15.3804 7.56639 15.3089 7.75279 15.1797 7.89645C15.0504 8.0401 14.8726 8.13084 14.6804 8.15118Z"
                    fill="black"
                  ></path>
                </svg>
                <p class="text-base leading-loose">{user.instagram}</p>
              </div>
              <div class="inline-flex space-x-3.5 items-center justify-center">
                <svg
                  width="22"
                  height="22"
                  viewBox="0 0 22 22"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M18.94 2.03516H3.46648C3.21287 2.03516 2.96965 2.1359 2.79033 2.31523C2.611 2.49456 2.51025 2.73778 2.51025 2.99138V18.4649C2.51025 18.5904 2.53499 18.7148 2.58304 18.8308C2.6311 18.9468 2.70153 19.0522 2.79033 19.141C2.87912 19.2298 2.98453 19.3002 3.10055 19.3483C3.21656 19.3963 3.34091 19.4211 3.46648 19.4211H11.7943V12.684H9.53417V10.0761H11.7943V8.12023C11.7475 7.66103 11.8017 7.19715 11.9532 6.76112C12.1046 6.32509 12.3496 5.92747 12.671 5.59615C12.9924 5.26483 13.3823 5.00784 13.8136 4.84319C14.2448 4.67854 14.7068 4.61023 15.1672 4.64304C15.8438 4.63888 16.5201 4.67371 17.1927 4.74736V7.09446H15.8105C14.7152 7.09446 14.5065 7.61604 14.5065 8.37233V10.0501H17.1144L16.7754 12.658H14.5065V19.4211H18.94C19.0655 19.4211 19.1899 19.3963 19.3059 19.3483C19.4219 19.3002 19.5273 19.2298 19.6161 19.141C19.7049 19.0522 19.7753 18.9468 19.8234 18.8308C19.8714 18.7148 19.8962 18.5904 19.8962 18.4649V2.99138C19.8962 2.86581 19.8714 2.74147 19.8234 2.62545C19.7753 2.50944 19.7049 2.40402 19.6161 2.31523C19.5273 2.22643 19.4219 2.156 19.3059 2.10794C19.1899 2.05989 19.0655 2.03516 18.94 2.03516Z"
                    fill="#2A2438"
                  ></path>
                </svg>
                <p class="text-base leading-loose">{user.facebook}</p>
              </div>
            </div>
          </div>

          {/* posts */}
          {this.state.posts && (
            <>
              <div class="p-3 sm:p-8 white-bg shadow w-full">
                <div class="">
                  <h2 class="leading-9 text-gray-900 m-0">Posts</h2>
                </div>
                <hr class="border-gray-300 border-opacity-50 my-5" />
                <div class="inline-flex flex-wrap items-start justify-around sm:justify-start space-y-5">
                  {
                    // console.log(this.state.posts.data)

                    // <InfiniteScroll
                    //   pageStart={0}
                    //   loadMore={this.loadMore}
                    //   hasMore={this.state.hasMore}
                    //   loader={
                    //     <div className="loader" key={0}>
                    //       Loading...
                    //     </div>
                    //   }
                    // >
                    //   {
                    //     this.state.posts?.data?.map((post, idx) => {
                    //       // if (post.hasImage)
                    //       //     <img src={post.image} className="xs:w-60 h-full rounded-lg m-2" />

                    //       return (
                    //         <div className="w-full">
                    //           <UserPostCard post={post} postOwner={user} key={idx} />
                    //         </div>
                    //       );
                    //     })
                    //   }
                    // </InfiniteScroll>

                    this.state.posts?.data?.map((post, idx) => {
                      // if (post.hasImage)
                      //     <img src={post.image} className="xs:w-60 h-full rounded-lg m-2" />

                      return (
                        <div className="w-full">
                          <UserPostCard post={post} postOwner={user} key={idx} />
                        </div>
                      );
                    })
                  }
                </div>
              </div>
            </>
          )}
        </div>
      </>
    );
  }
}
